{% extends "base.html" %}
{% block title %}{{ user.get_display_name() }} - Synaps{% endblock %}
{% block content %}
    <div class="profile-container">
        <div class="profile-header">
            <h2>–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
        </div>
        
        <!-- –ê–≤–∞—Ç–∞—Ä —ñ –æ—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
        <div class="profile-section">
            <div class="avatar-upload-container" style="justify-content: center; text-align: center;">
                <div class="profile-avatar-large" style="margin: 0 auto;">
                    {% if user.avatar_url %}
                        <img src="{{ user.avatar_url }}" alt="Avatar">
                    {% else %}
                        <div class="avatar-placeholder">{{ user.username[0].upper() }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 24px;">
                <h3 style="margin: 0 0 8px 0; font-size: 1.75rem;">{{ user.get_display_name() }}</h3>
                <p style="color: var(--text-secondary); margin: 0 0 16px 0;">@{{ user.username }}</p>
                
                {% if user.bio %}
                <p style="color: var(--text-primary); margin: 0 0 24px 0; max-width: 600px; margin-left: auto; margin-right: auto;">
                    {{ user.bio }}
                </p>
                {% endif %}
                
                <div style="display: flex; gap: 12px; justify-content: center; align-items: center; margin-top: 16px;">
                    <div style="color: var(--text-secondary); font-size: 0.875rem;">
                        {% if user.id in [u.id for u in current_user.get_favorites()] %}
                            <span style="color: var(--success); font-weight: 600;">‚≠ê –í –æ–±—Ä–∞–Ω–æ–º—É</span>
                        {% else %}
                            –û—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑: {{ user.last_seen.strftime('%d.%m.%Y –æ %H:%M') if user.last_seen else '–ù–µ–≤—ñ–¥–æ–º–æ' }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –î—ñ—ó -->
        <div class="profile-actions">
            <a href="{{ url_for('main.index') }}" class="btn-primary" style="text-decoration: none; display: inline-block; text-align: center;">
                üí¨ –ù–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            </a>
            
            {% if user.id in [u.id for u in current_user.get_favorites()] %}
                <button class="btn-secondary" data-user-id="{{ user.id }}" data-action="remove">
                    ‚ùå –í–∏–¥–∞–ª–∏—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ
                </button>
            {% else %}
                <button class="btn-secondary" data-user-id="{{ user.id }}" data-action="add">
                    ‚≠ê –î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ
                </button>
            {% endif %}
            
            <a href="{{ url_for('main.index') }}" class="btn-secondary" style="text-decoration: none; display: inline-block; text-align: center;">
                ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –¥–æ —á–∞—Ç—ñ–≤
            </a>
        </div>
    </div>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var favoriteButtons = document.querySelectorAll('button[data-action]');
        
        favoriteButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                var userId = this.getAttribute('data-user-id');
                var action = this.getAttribute('data-action');
                
                if (action === 'add') {
                    addFavorite(userId);
                } else if (action === 'remove') {
                    removeFavorite(userId);
                }
            });
        });
    });
    
    function addFavorite(userId) {
        fetch('/add_favorite/' + userId, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            if (data.success) {
                location.reload();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + data.error);
            }
        })
        .catch(function(error) {
            console.error('Error:', error);
            alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ –æ–±—Ä–∞–Ω–µ');
        });
    }
    
    function removeFavorite(userId) {
        fetch('/remove_favorite/' + userId, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            if (data.success) {
                location.reload();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + data.error);
            }
        })
        .catch(function(error) {
            console.error('Error:', error);
            alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –æ–±—Ä–∞–Ω–æ–≥–æ');
        });
    }
    </script>
{% endblock %}